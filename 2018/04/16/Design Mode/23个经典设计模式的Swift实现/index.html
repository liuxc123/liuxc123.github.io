<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="iOS,Swift,Design Mode," />





  <link rel="alternate" href="/atom.xml" title="liuxc的博客" type="application/atom+xml" />






<meta name="description" content="前言 这是一篇主观的文章，文字解释也尽可能简单，写作目的是一次团队内的知识分享，想让不了解设计模式的同事迅速对这些生词混个脸熟。所以本文适合懂Swift语法，想快速了解23个设计模式大概在讲什么的同学。  基本结构 比喻 让我联想到的一些事物 官方定义 原版定义 UML 不是原版UML 只保留了我觉得核心的部分 代码 Swift实现，这个是本体 讲解 假设已经看过代码的一些零散评注  目录 Cre">
<meta name="keywords" content="iOS,Swift,Design Mode">
<meta property="og:type" content="article">
<meta property="og:title" content="23个经典设计模式的Swift实现">
<meta property="og:url" content="http://yoursite.com/2018/04/16/Design Mode/23个经典设计模式的Swift实现/index.html">
<meta property="og:site_name" content="liuxc的博客">
<meta property="og:description" content="前言 这是一篇主观的文章，文字解释也尽可能简单，写作目的是一次团队内的知识分享，想让不了解设计模式的同事迅速对这些生词混个脸熟。所以本文适合懂Swift语法，想快速了解23个设计模式大概在讲什么的同学。  基本结构 比喻 让我联想到的一些事物 官方定义 原版定义 UML 不是原版UML 只保留了我觉得核心的部分 代码 Swift实现，这个是本体 讲解 假设已经看过代码的一些零散评注  目录 Cre">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://cdn1.alphr.com/sites/alphr/files/2016/02/tesla_factory_tour_1.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228b674df37c35?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228b6c46c23e40?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228b7414ea9071?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228b775f6ff3af?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://tse2.mm.bing.net/th?id=OIP.N3hIhcOq32Bh6Ezi6q6kGwHaFj&pid=Api">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228bd251c56c84?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://thumbs.dreamstime.com/z/cell-division-two-cells-divide-osmosis-background-other-cells-48181492.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228be892b4b350?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228bef47904c11?imageslim">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228bf3071227f0?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.wap135.com/270/timg08/uploaded/i8/TB2452gtpXXXXaLXXXXXXXXXXXX_!!622114048.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c30357dd989?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c4c4b5fc92c?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228e871b1e521e?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c553d9635f6?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://realtimeboard.com/static/images/page/examples/detail/organizational-chart.png">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c624d5b8e2d?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://cdn.marksdailyapple.com/wordpress/wp-content/themes/Marks-Daily-Apple-Responsive/images/blog2/coffee.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c6fcfc306fb?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c845ed667c4?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c87db8d9efa?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c8a0ba5d3bd?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.computerhope.com/issues/pictures/cpu_cache_die.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c958468b9bc?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://tse2.mm.bing.net/th?id=OIP.igizh16RdxH-Xq9jCR7KLgHaCx&w=300&h=112&c=7&o=5&dpr=2&pid=1.7">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228c9e9eea16e6?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.joezimjs.com/wp-content/uploads/chain_of_responsibility_atm.png">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228cb99e25bae4?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://cdn.wikimg.net/strategywiki/images/thumb/e/e3/Light-bot_2-3.jpg/914px-Light-bot_2-3.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228cc35893ebcd?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://staticdelivery.nexusmods.com/mods/110/images/thumbnails/32821-3-1362476170.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228cf4dc93e284?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.sohu.com/a/207894434_99978064">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228d3d31b98ecd?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.quanjing.com/imgbuy/top-959496.html">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228d53f4b53f69?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://gearnuke.com/wp-content/uploads/2015/05/witcher3-ps4-savedata-2.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228d64aa233b5b?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228da2e23244fc?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="http://www.superluigibros.com/images/super_mario_bros_3_power_ups.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228db1d5c7bca9?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228dd0637fd07c?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228dd3b95a8bda?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3167143621,3882552175&fm=27&gp=0.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228def70189866?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:image" content="https://marketingland.com/wp-content/ml-loads/2014/08/hotel-bell-customer-service-ss-1920.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16228dfe6161d8d4?imageView2/0/w/1280/h/960/ignore-error/1">
<meta property="og:updated_time" content="2018-04-23T01:21:02.946Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="23个经典设计模式的Swift实现">
<meta name="twitter:description" content="前言 这是一篇主观的文章，文字解释也尽可能简单，写作目的是一次团队内的知识分享，想让不了解设计模式的同事迅速对这些生词混个脸熟。所以本文适合懂Swift语法，想快速了解23个设计模式大概在讲什么的同学。  基本结构 比喻 让我联想到的一些事物 官方定义 原版定义 UML 不是原版UML 只保留了我觉得核心的部分 代码 Swift实现，这个是本体 讲解 假设已经看过代码的一些零散评注  目录 Cre">
<meta name="twitter:image" content="http://cdn1.alphr.com/sites/alphr/files/2016/02/tesla_factory_tour_1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/04/16/Design Mode/23个经典设计模式的Swift实现/"/>





  <title>23个经典设计模式的Swift实现 | liuxc的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">liuxc的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">每天进步一点点</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/16/Design Mode/23个经典设计模式的Swift实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liuxc">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuxc的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">23个经典设计模式的Swift实现</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-16T16:27:56+08:00">
                2018-04-16
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-23T09:21:02+08:00">
                2018-04-23
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/Design-Mode/" itemprop="url" rel="index">
                    <span itemprop="name">Design Mode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/16/Design Mode/23个经典设计模式的Swift实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/16/Design Mode/23个经典设计模式的Swift实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8,428
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  36
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>这是一篇主观的文章，文字解释也尽可能简单，写作目的是一次团队内的知识分享，想让不了解设计模式的同事迅速对这些生词混个脸熟。所以本文适合懂Swift语法，想快速了解23个设计模式大概在讲什么的同学。</p>
</blockquote>
<h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><ul>
<li>比喻 让我联想到的一些事物</li>
<li>官方定义 原版定义</li>
<li>UML 不是原版UML 只保留了我觉得核心的部分</li>
<li>代码 Swift实现，这个是本体</li>
<li>讲解 假设已经看过代码的一些零散评注</li>
</ul>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><p>Creational 创建型 5</p>
<ul>
<li>Abstract Factory 抽象工厂模式</li>
<li>Builder 建造者模式</li>
<li>Factory Method 工厂方法模式</li>
<li>Prototype 原型模式</li>
<li>Singleton 单例模式</li>
</ul>
</li>
<li><p>Structural 结构型 7</p>
<ul>
<li>Adapter 适配器模式</li>
<li>Bridge 桥接模式</li>
<li>Composite 组合模式</li>
<li>Decorator 装饰者模式</li>
<li>Facade 外观模式</li>
<li>Flyweight 享元模式</li>
<li>Proxy 代理模式</li>
</ul>
</li>
</ul>
<ul>
<li><p>Behavioral 行为型 11</p>
<ul>
<li>Chain of responsibility 责任链模式</li>
<li>Command 命令模式</li>
<li>Interpreter 解释器模式</li>
<li>Iterator 迭代器模式</li>
<li>Mediator 中介模式</li>
<li>Memento 备忘录模式</li>
<li>Observer 观察者模式</li>
<li>State 状态模式</li>
<li>Strategy 策略模式</li>
<li>Template Method 模板方法模式</li>
<li>Visitor 访问者模式</li>
</ul>
</li>
</ul>
<hr>
<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><blockquote>
<p>工厂模式顾名思义，就像一个工厂生产你所需要的产品</p>
</blockquote>
<p><img src="http://cdn1.alphr.com/sites/alphr/files/2016/02/tesla_factory_tour_1.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://cdn1.alphr.com/sites/alphr/files/2016/02/tesla_factory_tour_1.jpg" target="_blank" rel="noopener">http://cdn1.alphr.com/sites/alphr/files/2016/02/tesla_factory_tour_1.jpg</a></p>
</blockquote>
<h3 id="无工厂-Non-Factory"><a href="#无工厂-Non-Factory" class="headerlink" title="无工厂 Non-Factory"></a>无工厂 Non-Factory</h3><p>也就是工厂问题想解决的原始问题。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228b674df37c35?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">protocol Product&#123;&#125;</span><br><span class="line">class ConcreteProductA: Produce &#123;&#125;</span><br><span class="line">class ConcreteProductB: Produce &#123;&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">    func createProduct(type: Int) -&gt; Produce &#123;</span><br><span class="line">        if type == 0 &#123;</span><br><span class="line">            return ConcreteProductA()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return ConcreteProductB()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Client()</span><br><span class="line">c.createProduct(type: 0) // get ConcreteProductA</span><br></pre></td></tr></table></figure>
<p>从代码和UML可以看出，为了得到产品A，调用者<code>Client</code>要同时依赖<code>Product</code>, <code>ConcreteProductA</code>和<code>ConcreteProductB</code>，并亲自写一个创建产品的方法。</p>
<p>每当需求新增一个产品，就要改动到调用方<code>Client</code>。如果这一堆创建代码如果可以抽离出去就好了，于是简单工厂出现了。</p>
<h3 id="简单工厂-Simple-Factory"><a href="#简单工厂-Simple-Factory" class="headerlink" title="简单工厂 Simple Factory"></a>简单工厂 Simple Factory</h3><p>简单工厂就做了一件事，<strong>把Client要做的创建工作，挪到了另一个类里。</strong></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228b6c46c23e40?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">protocol Product&#123;&#125;</span><br><span class="line">class ConcreteProductA: Produce &#123;&#125;</span><br><span class="line">class ConcreteProductB: Produce &#123;&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">    let s = Factory()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Factory &#123;</span><br><span class="line">    func createProduct(type: Int) -&gt; Product &#123;</span><br><span class="line">        if type == 0 &#123;</span><br><span class="line">            return ConcreteProductA()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return ConcreteProductA()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Client()</span><br><span class="line">c.s.createProduct(type: 0) // get ConcreteProductA</span><br></pre></td></tr></table></figure>
<p><code>Factory</code>代替了<code>Client</code>对具体<code>Product</code>的依赖，那么当需求变化的时候，我们不再需要改动调用方。这固然有所进步，但无法避免的是，<strong>每次变动都要在createProduct的方法内部新增一个if-else分支</strong>，这显然违背了<a href="https://en.wikipedia.org/wiki/Open/closed_principle" target="_blank" rel="noopener">开闭原则</a>。</p>
<p>为了解决这个问题，我们引入另一个模式。</p>
<h3 id="工厂方法-Factory-Method"><a href="#工厂方法-Factory-Method" class="headerlink" title="工厂方法 Factory Method"></a>工厂方法 Factory Method</h3><p>官方定义</p>
<blockquote>
<p>定义一个创建对象的接口，让其子类自己决定实例化哪一个工厂类，工厂模式使其创建过程延迟到子类进行。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228b7414ea9071?imageView2/0/w/1280/h/960/ignore-error/1" alt="工厂方法"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">protocol Product&#123;&#125;</span><br><span class="line">class ConcreteProductA: Produce &#123;&#125;</span><br><span class="line">class ConcreteProductB: Produce &#123;&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">    let f = Factory()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Factory &#123;</span><br><span class="line">    func createProduct() -&gt; Product? &#123; return nil &#125; //用于继承</span><br><span class="line">    func createProduct(type: Int) -&gt; Product? &#123; //用于调用</span><br><span class="line">        if type == 0 &#123;</span><br><span class="line">            return ConcreteFactoryA().createProduct()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return ConcreteFactoryB().createProduct()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteFactoryA: Factory &#123;</span><br><span class="line">    override func createProduct() -&gt; Product? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductA()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteFactoryB: Factory &#123;</span><br><span class="line">    override func createProduct() -&gt; Product? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductB()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Client()</span><br><span class="line">c.f.createProduct(type: 0) // get ConcreteProductA</span><br></pre></td></tr></table></figure>
<p>对于工厂方法的实现，有众多不同的解法，比如<code>Factory</code>只保留一个<code>createProduct</code>让子类实现，让<code>Client</code>来选择生成哪个具体工厂实例；或是引入一个FactoryMaker的中间层，作为生产工厂的“简单工厂”。我这里采用的方式是Factory既作为工厂父类，让具体工厂决定生产生么产品，又作为接口类，让<code>Client</code>可以通过<a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">依赖注入</a>选择特定工厂。我这样做的目的是，在不引入新的中间层的情况下，最小化Client的依赖。</p>
<p>工厂方法在简单工厂的基础上做了两件事：</p>
<ul>
<li>多了一层抽象，把生产产品的工作延迟到子类执行。</li>
<li>把“选择如何生产产品的工作”转化为“选择让哪个具体工厂生产”。</li>
</ul>
<p>工厂方法的贡献在于，这样做虽然不能完美避免对一个if-else的扩展，但是这个扩展规模被极大限制住了（只需要new一个类）。</p>
<p>工厂方法着重点是解决了单一产品线的派生问题。那如果有多个相关产品线呢？</p>
<h3 id="抽象工厂-Abstract-Factory"><a href="#抽象工厂-Abstract-Factory" class="headerlink" title="抽象工厂 Abstract Factory"></a>抽象工厂 Abstract Factory</h3><p>官方定义</p>
<blockquote>
<p>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228b775f6ff3af?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">protocol ProductA &#123;&#125;</span><br><span class="line">class ConcreteProductA1: ProductA &#123;&#125;</span><br><span class="line">class ConcreteProductA2: ProductA &#123;&#125;</span><br><span class="line"></span><br><span class="line">protocol ProductB &#123;&#125;</span><br><span class="line">class ConcreteProductB1: ProductB &#123;&#125;</span><br><span class="line">class ConcreteProductB2: ProductB &#123;&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">    let f = Factory()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Factory &#123;</span><br><span class="line">    func createProductA() -&gt; ProductA? &#123; return nil &#125; // 用于继承</span><br><span class="line">    func createProductB() -&gt; ProductB? &#123; return nil &#125; // 用于继承</span><br><span class="line">    func createProductA(type: Int) -&gt; ProductA? &#123; // 用于调用</span><br><span class="line">        if type == 0 &#123;</span><br><span class="line">            return ConcreteFactory1().createProductA()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return ConcreteFactory2().createProductA()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    func createProductB(type: Int) -&gt; ProductB? &#123; // 用于调用</span><br><span class="line">        if type == 0 &#123;</span><br><span class="line">            return ConcreteFactory1().createProductB()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return ConcreteFactory2().createProductB()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteFactory1: Factory &#123;</span><br><span class="line">    override func createProductA() -&gt; ProductA? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductA1()</span><br><span class="line">    &#125;</span><br><span class="line">    override func createProductB() -&gt; ProductB? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductB1()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteFactory2: Factory &#123;</span><br><span class="line">    override func createProductA() -&gt; ProductA? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductA2()</span><br><span class="line">    &#125;</span><br><span class="line">    override func createProductB() -&gt; ProductB? &#123;</span><br><span class="line">        // ... 产品加工过程</span><br><span class="line">        return ConcreteProductB2()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Client()</span><br><span class="line">c.f.createProductA(type: 0) // get ConcreteProductA1</span><br><span class="line">c.f.createProductA(type: 1) // get ConcreteProductA2</span><br><span class="line">c.f.createProductB(type: 0) // get ConcreteProductB1</span><br><span class="line">c.f.createProductB(type: 1) // get ConcreteProductB2</span><br></pre></td></tr></table></figure>
<p>图很吓人，其实很简单。</p>
<p>当我们有两个相关的产品线<code>ProductA</code>和<code>ProductB</code>, 例如螺丝和螺母，他们派生出<code>ProductA1</code>，<code>ProductB1</code> 和 <code>ProductA2</code>，<code>ProductB2</code>，前者我们由工厂<code>ConcreteFactory1</code>来制作，后者由 <code>ConcreteFactory2</code>来制作。</p>
<p>对于<code>Client</code>来说，他只需要知道有一个抽象的工厂能同时生产<code>ProductA</code>和<code>ProductB</code>就行了，那就是图中的Factory。</p>
<p><strong>重点来了</strong>，这个抽象的<code>Factory</code>是通过“工厂方法”模式把构造过程延迟到子类执行的，也就是说，抽象工厂是建立在工厂方法的基础上的模式。<br>所以抽象工厂，换句话说，就是多个产品线需要绑定在一起，形成一个抽象的综合工厂，由具体的综合工厂来批量实现“工厂方法”的一种更“高级”的模式。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>有点绕，说完这些感觉我已经中文十级了。总之，我想表达的观点是：<strong>这些工厂模式并不是割裂的存在，而是一个递进的思想。</strong></p>
<hr>
<h2 id="Builder-建造者模式"><a href="#Builder-建造者模式" class="headerlink" title="Builder 建造者模式"></a>Builder 建造者模式</h2><blockquote>
<p>建造者模式就像你委托一个室内设计师装修你的新家</p>
</blockquote>
<p><img src="http://tse2.mm.bing.net/th?id=OIP.N3hIhcOq32Bh6Ezi6q6kGwHaFj&amp;pid=Api" alt=""></p>
<blockquote>
<p>配图: <a href="http://tse2.mm.bing.net/th?id=OIP.N3hIhcOq32Bh6Ezi6q6kGwHaFj&amp;pid=Api" target="_blank" rel="noopener">http://tse2.mm.bing.net/th?id=OIP.N3hIhcOq32Bh6Ezi6q6kGwHaFj&amp;pid=Api</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>将一个复杂的构建与其表示相分离，使得同样的构建过程可以创建不同的表示。</p>
</blockquote>
<p>如果说之前的谈到的工厂模式是把创建产品(对象)的工作抽离出去的话，这次要聊的建造者模式，就是把产品内部的组件生产工作抽离出去。这样做的场景，适用于那些有着复杂、规则模块的对象生成流程。换句话说，工厂模式是一个类(工厂)创建另一个类(产品)，而建造者是一个类(产品)自身的属性(组件)构造过程。</p>
<p>对于建造者模式的实现网上也是版本不一：复杂点的版本会引入一个Director的角色，做一个整体上下文，组装更傻瓜化的builder和product。或是抽象一层Builder协议，用不同的具体Builder来构造不同的产品。但我认为这些都模糊了这个模式要传达的焦点，对理解没有帮助，所以这里我选择一个极简的模型。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228bd251c56c84?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">struct Builder &#123;</span><br><span class="line">    var partA: String</span><br><span class="line">    var partB: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Product &#123;</span><br><span class="line">    var partA: String</span><br><span class="line">    var partB: String</span><br><span class="line">    init(builder: Builder) &#123;</span><br><span class="line">        partA = builder.partA</span><br><span class="line">        partB = builder.partB</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 通过builder完成产品创建工作</span><br><span class="line">let b = Builder(partA: &quot;A&quot;, partB: &quot;B&quot;)</span><br><span class="line">// 这样产品只需要一个builder就可以完成制作</span><br><span class="line">let p = Product(builder: b)</span><br></pre></td></tr></table></figure>
<p>我们让Product的生成由自己发起，但是它的组件(属性)全都委托给Builder来实现，而它只需要依赖一个Builder就完成了自身的生产工作。</p>
<hr>
<h2 id="Prototype-原型模式"><a href="#Prototype-原型模式" class="headerlink" title="Prototype 原型模式"></a>Prototype 原型模式</h2><blockquote>
<p>原型模式让你有了一个可以源源不断自我赋值的类。</p>
</blockquote>
<p><img src="http://thumbs.dreamstime.com/z/cell-division-two-cells-divide-osmosis-background-other-cells-48181492.jpg" alt=""></p>
<blockquote>
<p>配图: <a href="http://thumbs.dreamstime.com/z/cell-division-two-cells-divide-osmosis-background-other-cells-48181492.jpg" target="_blank" rel="noopener">http://thumbs.dreamstime.com/z/cell-division-two-cells-divide-osmosis-background-other-cells-48181492.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
</blockquote>
<p>原型模式很简单，你只要实现一个<strong>返回你自己的新对象</strong>的方法即可。这里我采用的实现还不是最简单的，这个interface并不是必须的。</p>
<p>原型模式实现了深拷贝。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228be892b4b350?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">protocol Prototype &#123;</span><br><span class="line">    func clone() -&gt; Prototype</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Product: Prototype &#123;</span><br><span class="line">    var title: String</span><br><span class="line">    func clone() -&gt; Prototype &#123;</span><br><span class="line">        return Product(title: title)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let p1 = Product(title: &quot;p1&quot;)</span><br><span class="line">let p2 = p1.clone()</span><br><span class="line">(p2 as? Product)?.title // OUTPUT: p1</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Singleton-单例模式"><a href="#Singleton-单例模式" class="headerlink" title="Singleton 单例模式"></a>Singleton 单例模式</h2><blockquote>
<p>单例就像一个公司的IT部门，他们是唯一的存在，并且被所有人直接访问。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228bef47904c11?imageslim" alt=""></p>
<blockquote>
<p>配图：The IT Crowd</p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
</blockquote>
<p>因为第二点常常被忽视，所以过度使用的危害极大，你无从知道调用从何而来，这种<code>goto</code>一般的存在会变成维护的噩梦。</p>
<p>单例比较常见的应用是例如数据库，网络框架的全局访问点。</p>
<p>单例其实就是<strong>变种</strong>的原型模式，只不过原型每次返回的是一个拷贝。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228bf3071227f0?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<p>Swift的简单实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Singleton &#123;</span><br><span class="line">    static let sharedInstance = Singleton()</span><br><span class="line">    private init() &#123;</span><br><span class="line">        // 用private防止被new</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let s  = Singleton.sharedInstance</span><br><span class="line">let s2 = Singleton() // ERROR: initializer is inaccessible due to &apos;private&apos; protection level</span><br></pre></td></tr></table></figure>
<p>Swift的完整实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Singleton &#123;</span><br><span class="line">    static var singleton: Singleton? = nil</span><br><span class="line">    private init() &#123;&#125;</span><br><span class="line">    static func sharedInstance() -&gt; Singleton &#123;</span><br><span class="line">        if singleton == nil &#123;</span><br><span class="line">            singleton = Singleton()</span><br><span class="line">        &#125;</span><br><span class="line">        return singleton!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let s = Singleton.sharedInstance()</span><br><span class="line">let s2 = Singleton() // ERROR: initializer is inaccessible due to &apos;private&apos; protection level</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Adapter-适配器模式"><a href="#Adapter-适配器模式" class="headerlink" title="Adapter 适配器模式"></a>Adapter 适配器模式</h2><blockquote>
<p>适配器就像一个电源转换插头。</p>
</blockquote>
<p><img src="http://www.wap135.com/270/timg08/uploaded/i8/TB2452gtpXXXXaLXXXXXXXXXXXX_!!622114048.jpg" alt=""></p>
<blockquote>
<p>配图: <a href="http://www.wap135.com/270/timg08/uploaded/i8/TB2452gtpXXXXaLXXXXXXXXXXXX_!!622114048.jpg" target="_blank" rel="noopener">http://www.wap135.com/270/timg08/uploaded/i8/TB2452gtpXXXXaLXXXXXXXXXXXX_!!622114048.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>将一个类的接口转换成客户希望的另外一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
</blockquote>
<p>一个类能称之为适配器，就是指它能把另一个类进行某种变形，让其能和实际需求对接。 比如一个底层数据模型，可以通过不同的UI适配器，对应不同的展现需要。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c30357dd989?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">protocol Target &#123;</span><br><span class="line">    var value: String &#123; get &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Adapter: Target &#123;</span><br><span class="line">    let adaptee: Adaptee</span><br><span class="line">    var value: String &#123;</span><br><span class="line">        return &quot;\(adaptee.value)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    init(_ adaptee: Adaptee) &#123;</span><br><span class="line">        self.adaptee = adaptee</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Adaptee &#123;</span><br><span class="line">    var value: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Adapter(Adaptee(value: 1)).value // &quot;1&quot;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Bridge-桥接模式"><a href="#Bridge-桥接模式" class="headerlink" title="Bridge 桥接模式"></a>Bridge 桥接模式</h2><blockquote>
<p>桥接模式就是这么一座桥，它矗立在具体和抽象之间，当你调用的时候只看到了抽象，但是它内部实现时“桥接”到了具体。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c4c4b5fc92c?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<blockquote>
<p>配图: <a href="https://user-gold-cdn.xitu.io/2018/3/15/16228c4c4b5fc92c?imageView2/0/w/1280/h/960/ignore-error/1" target="_blank" rel="noopener">https://user-gold-cdn.xitu.io/2018/3/15/16228c4c4b5fc92c?imageView2/0/w/1280/h/960/ignore-error/1</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>将抽象部分与实现部分分离，使它们都可以独立的变化。</p>
</blockquote>
<p>桥接模式是继工厂模式之后另一个有点绕的概念，为了不一言不合就抛概念把大家绕晕，我们直接来看一下这个模式最终成型的样子。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228e871b1e521e?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<p>首先假设我们封装了一个“开关能力”的接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protocol 开关能力 &#123;</span><br><span class="line">    func turnOn(_ on: Bool)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个接口只有一个方法，实现者需要提供打开/关闭开关会触发什么操作。</p>
<p>然后我们抽象一个叫“设备”的类出来，这个类就有意思了：</p>
<ul>
<li>首先他有一个实现了开关能力的实例变量，并通过初始化赋好值。</li>
<li>他有一个方法的实现就是直接提供了开关能力里的实现。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class 设备 &#123;</span><br><span class="line">    let obj: 开关能力</span><br><span class="line">    func turnOn(_ on: Bool) &#123;</span><br><span class="line">        obj.turnOn(on)</span><br><span class="line">    &#125;</span><br><span class="line">    init(_ obj: 开关能力) &#123;</span><br><span class="line">        self.obj = obj</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，其实一个桥接模式就已经搭建完了。再讲解之前，我们直接看一下如何应用它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class 电视: 开关能力 &#123;</span><br><span class="line">    func turnOn(_ on: Bool) &#123;</span><br><span class="line">        if on &#123;</span><br><span class="line">            // 打开电视</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 关闭电视</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class 空调: 开关能力 &#123;</span><br><span class="line">    func turnOn(_ on: Bool) &#123;</span><br><span class="line">        if on &#123;</span><br><span class="line">            // 打开空调</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 关闭空调</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let tv = 设备(电视())</span><br><span class="line">tv.turnOn(true) // 打开电视</span><br><span class="line"></span><br><span class="line">let aircon = 设备(空调())</span><br><span class="line">aircon.turnOn(false) // 关闭空调</span><br></pre></td></tr></table></figure>
<p>通过这段代码可以看出：</p>
<p>在把抽象的<code>设备</code>应用到具体的业务的时候，这个模式采用的是组合了一个实现了<code>开关能力</code>接口的实例，而没用继承。<br>最终调用的时候，是由统一的<code>设备</code>作为接入点的，而不是<code>电视</code>，<code>空调</code>这些具体类，具体的实现是通过组合的方式注入到<code>设备</code>里的。</p>
<p>了解了这个流程后，一个事情就明朗了：</p>
<blockquote>
<p>这不就是在用组合代替继承吗？</p>
</blockquote>
<p>没错，它把需要变化的代码通过接口代理出去，而避免了继承。</p>
<p>但是，桥接模式的桥在哪里？</p>
<p>这时，要搬出他的概念了： <a href="https://en.wikipedia.org/wiki/Bridge_pattern" target="_blank" rel="noopener">Bridge pattern - Wikipedia：</a></p>
<blockquote>
<p>The bridge pattern is a design pattern used in software engineering which is meant to “decouple an abstraction from its implementation so that the two can vary independently”.<br>桥接模式解耦了抽象和具体，让它们可以独立变化。</p>
</blockquote>
<p>从代码去寻找具体和抽象，就可以发现：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c553d9635f6?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<p><strong>这座桥能走通的关键就是这个组合在抽象类里的变量。</strong></p>
<p>最后，你会发现，这不就是Adapter和Adaptee吗？ <del>没错，设计模式其实是连续剧来着。</del></p>
<p>不同在于适配器的关注点是<strong>如何让两个不兼容的类对接</strong>， 而桥接模式关注点是<strong>解耦</strong>。</p>
<hr>
<h2 id="Composite-组合模式"><a href="#Composite-组合模式" class="headerlink" title="Composite 组合模式"></a>Composite 组合模式</h2><blockquote>
<p>组合模式就像一个公司的组织架构，存在基层员工(Leaf)和管理者(Composite)，他们都实现了组件(Component)的work方法，这种树状结构的每一级都是一个功能完备的个体。</p>
</blockquote>
<p><img src="https://realtimeboard.com/static/images/page/examples/detail/organizational-chart.png" alt=""></p>
<blockquote>
<p>配图：<a href="https://realtimeboard.com/static/images/page/examples/detail/organizational-chart.png" target="_blank" rel="noopener">https://realtimeboard.com/static/images/page/examples/detail/organizational-chart.png</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>将对象组合成树形结构以表示”部分-整体”的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性。</p>
</blockquote>
<p>这个组合模式不是“组合优于继承”的那种“组合”，这里是狭义的指代一种特定场景，就是如配图描述的一种树状结构。</p>
<p>理解这个模式要知道三个设定：</p>
<ul>
<li><strong>Component</strong>：一个有功能性的组件。</li>
<li><strong>Leaf</strong>：它实现了组件。</li>
<li><strong>Composite</strong>：它既实现了组件，他又包含多个组件。</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c624d5b8e2d?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">protocol Component &#123;</span><br><span class="line">    func someMethod()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Leaf: Component &#123;</span><br><span class="line">    func someMethod() &#123;</span><br><span class="line">        // Leaf</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Composite: Component &#123;</span><br><span class="line">    var components = [Component]()</span><br><span class="line">    func someMethod() &#123;</span><br><span class="line">        // Composite</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let leaf = Leaf()</span><br><span class="line">let composite = Composite()</span><br><span class="line">composite.components += [leaf]</span><br><span class="line"></span><br><span class="line">composite.someMethod()</span><br><span class="line">leaf.someMethod()</span><br></pre></td></tr></table></figure>
<p>这个模式的精髓就是<code>Composite</code>这个角色，事实上<code>Leaf</code>可以看做一个特殊的<code>Compostie</code>。由于他即可以是一个功能执行者，又可以包含其它节点，这个特性可以派生出泛用度很高的树状结构。</p>
<hr>
<h2 id="Decorator-装饰者模式"><a href="#Decorator-装饰者模式" class="headerlink" title="Decorator 装饰者模式"></a>Decorator 装饰者模式</h2><blockquote>
<p>如果点咖啡时价格的计算是<code>牛奶(糖(咖啡(价格: 19元)))</code>就好了</p>
</blockquote>
<p><img src="http://cdn.marksdailyapple.com/wordpress/wp-content/themes/Marks-Daily-Apple-Responsive/images/blog2/coffee.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://cdn.marksdailyapple.com/wordpress/wp-content/themes/Marks-Daily-Apple-Responsive/images/blog2/coffee.jpg" target="_blank" rel="noopener">http://cdn.marksdailyapple.com/wordpress/wp-content/themes/Marks-Daily-Apple-Responsive/images/blog2/coffee.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>动态地给一个对象添加一些额外的职责。就增加功能来说，装饰器模式相比生成子类更为灵活。</p>
</blockquote>
<p>下面我们就用装饰者模式的思想来设计这个点咖啡程序:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c6fcfc306fb?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">protocol Component &#123;</span><br><span class="line">    var cost: Int &#123; get &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol Decorator: Component &#123;</span><br><span class="line">    var component: Component &#123; get &#125;</span><br><span class="line">    init(_ component: Component)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Coffee: Component &#123;</span><br><span class="line">    var cost: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Sugar: Decorator &#123;</span><br><span class="line">    var cost: Int &#123;</span><br><span class="line">        return component.cost + 1</span><br><span class="line">    &#125;</span><br><span class="line">    var component: Component</span><br><span class="line">    init(_ component: Component) &#123;</span><br><span class="line">        self.component = component</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Milk: Decorator &#123;</span><br><span class="line">    var cost: Int &#123;</span><br><span class="line">        return component.cost + 2</span><br><span class="line">    &#125;</span><br><span class="line">    var component: Component</span><br><span class="line">    init(_ component: Component) &#123;</span><br><span class="line">        self.component = component</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Milk(Sugar(Coffee(cost: 19))).cost</span><br></pre></td></tr></table></figure>
<p>当你的需求是零散的不断给“主菜加点佐料”的时候，并且这些佐料会经常变化，那么这个模式就可以有效的解决排列组合产生的类爆炸</p>
<p>理解的一个关键点就是区分<strong>组件Component和装饰者Decorator</strong>两个角色，单纯组件的实现者（咖啡）是被装饰的对象，他不再能装饰别人。</p>
<p>这个模式没有一个集中的<strong>计算器</strong>，每一个装饰者都参与了部分计算并输出当下的结果。</p>
<hr>
<h2 id="Facade-外观模式"><a href="#Facade-外观模式" class="headerlink" title="Facade 外观模式"></a>Facade 外观模式</h2><blockquote>
<p>外观模式就是化繁为简。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c845ed667c4?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.3dmgame.com/news/201709/3684484.html" target="_blank" rel="noopener">http://www.3dmgame.com/news/201709/3684484.html</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
</blockquote>
<p>值得一提的是，这个单词读音很怪。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c87db8d9efa?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<p>在谈起外观模式的时候，常常是指对一个复杂的(旧)代码库在不改变其内在的情况下，包装一层易于调用的表层API。</p>
<p>外观模式不会采用继承，而是用接口和组合。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c8a0ba5d3bd?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">protocol Facade &#123;</span><br><span class="line">    func simpleMethod()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class LegacyCode &#123;</span><br><span class="line">    func someMethod1() &#123; &#125;</span><br><span class="line">    func someMethod2() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension LegacyCode: Facade &#123;</span><br><span class="line">    func simpleMethod() &#123;</span><br><span class="line">        someMethod1()</span><br><span class="line">        someMethod2()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">    let f: Facade = LegacyCode()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Client()</span><br><span class="line">c.f.simpleMethod()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Flyweight-享元模式"><a href="#Flyweight-享元模式" class="headerlink" title="Flyweight 享元模式"></a>Flyweight 享元模式</h2><blockquote>
<p>享元模式就像CPU的Cache Memory，它通过对缓存的命中来实现速度的提升和内存的降低。</p>
</blockquote>
<p><img src="http://www.computerhope.com/issues/pictures/cpu_cache_die.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.computerhope.com/issues/pictures/cpu_cache_die.jpg" target="_blank" rel="noopener">http://www.computerhope.com/issues/pictures/cpu_cache_die.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>运用共享技术有效地支持大量细粒度的对象。</p>
</blockquote>
<p>享元模式其实就是指一套缓存系统。 显然他是一种复合模式，使用工厂模式来创造实例。 适用场景是系统中存在重复的对象创建过程。 好处是节省了内存加快了速度。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c958468b9bc?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">struct TargetObject &#123;</span><br><span class="line">    var title: String?</span><br><span class="line">    func printTitle() &#123;</span><br><span class="line">        print(title)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Cache &#123;</span><br><span class="line">    var targetObjects = [String: TargetObject]()</span><br><span class="line">    func lookup(key: String) -&gt; TargetObject &#123;</span><br><span class="line">        if targetObjects.index(forKey: key) == nil &#123;</span><br><span class="line">            return TargetObject()</span><br><span class="line">        &#125;</span><br><span class="line">        return targetObjects[key]!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Cache()</span><br><span class="line">c.targetObjects[&quot;Test&quot;] = TargetObject(title: &quot;Test&quot;)</span><br><span class="line">c.lookup(key: &quot;123&quot;).printTitle() // nil</span><br><span class="line">c.lookup(key: &quot;Test&quot;).printTitle() // Test</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Proxy-代理模式"><a href="#Proxy-代理模式" class="headerlink" title="Proxy 代理模式"></a>Proxy 代理模式</h2><blockquote>
<p>代理模式让一个类成为了另一个类的实际接口。</p>
</blockquote>
<p><img src="http://tse2.mm.bing.net/th?id=OIP.igizh16RdxH-Xq9jCR7KLgHaCx&amp;w=300&amp;h=112&amp;c=7&amp;o=5&amp;dpr=2&amp;pid=1.7" alt=""></p>
<p><strong>官方定义</strong></p>
<blockquote>
<p>为其他对象提供一种代理以控制对这个对象的访问。</p>
</blockquote>
<p>有两种常见的代理场景：</p>
<ul>
<li><strong>Protection proxy</strong>： 出于安全考虑，通过一个表层的类间接调用底层的类。</li>
<li><strong>Virtual proxy</strong>：出于性能考虑，通过一个低耗的类延迟调用一个高耗的类。</li>
</ul>
<p>但他们的实现是类似的：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228c9e9eea16e6?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">protocol Subject &#123;</span><br><span class="line">    mutating func operation()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct SecretObject: Subject &#123;</span><br><span class="line">    func operation() &#123;</span><br><span class="line">        // real implementation</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct PublicObject: Subject &#123;</span><br><span class="line">    private lazy var s = SecretObject()</span><br><span class="line">    mutating func operation() &#123;</span><br><span class="line">        s.operation()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p = PublicObject()</span><br><span class="line">p.operation()</span><br></pre></td></tr></table></figure>
<p><code>SecretObject</code>既可以看做一个隐藏类，又可以看做一个高费的类。通过<code>PublicObject</code>对他的代理，可以实现信息隐藏和延迟加载两个特性。</p>
<hr>
<h2 id="Chain-of-responsibility-责任链模式"><a href="#Chain-of-responsibility-责任链模式" class="headerlink" title="Chain of responsibility 责任链模式"></a>Chain of responsibility 责任链模式</h2><blockquote>
<p>责任链模式就像去取钱，每一面值都参与了计算和职责传递。</p>
</blockquote>
<p><img src="http://www.joezimjs.com/wp-content/uploads/chain_of_responsibility_atm.png" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.joezimjs.com/wp-content/uploads/chain_of_responsibility_atm.png" target="_blank" rel="noopener">http://www.joezimjs.com/wp-content/uploads/chain_of_responsibility_atm.png</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">避免请求发送者与接收者耦合在一起，让多个对象都有可能接收请求，将这些对象连接成一条链，并且沿着这条链传递请求，直到有对象处理它为止。</span><br></pre></td></tr></table></figure>
<p>UIKit的touch事件就应用了责任链模式</p>
<p>这个模式的实现就是<strong>既实现一个接口，又组合这个接口</strong>，这样自己执行完毕后就可以调用下一个执行者。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228cb99e25bae4?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">protocol ChainTouchable &#123;</span><br><span class="line">    var next: ChainTouchable? &#123; get &#125;</span><br><span class="line">    func touch()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ViewA: ChainTouchable &#123;</span><br><span class="line">    var next: ChainTouchable? = ViewB()</span><br><span class="line">    func touch() &#123;</span><br><span class="line">        next?.touch()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ViewB: ChainTouchable &#123;</span><br><span class="line">    var next: ChainTouchable? = ViewC()</span><br><span class="line">    func touch() &#123;</span><br><span class="line">        next?.touch()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ViewC: ChainTouchable &#123;</span><br><span class="line">    var next: ChainTouchable? = nil</span><br><span class="line">    func touch() &#123;</span><br><span class="line">        print(&quot;C&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let a = ViewA()</span><br><span class="line">a.touch() // OUTPUT: C</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Command-命令模式"><a href="#Command-命令模式" class="headerlink" title="Command 命令模式"></a>Command 命令模式</h2><blockquote>
<p>命令模式就是一种指令系统。</p>
</blockquote>
<p><img src="http://cdn.wikimg.net/strategywiki/images/thumb/e/e3/Light-bot_2-3.jpg/914px-Light-bot_2-3.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://cdn.wikimg.net/strategywiki/images/thumb/e/e3/Light-bot_2-3.jpg/914px-Light-bot_2-3.jpg" target="_blank" rel="noopener">http://cdn.wikimg.net/strategywiki/images/thumb/e/e3/Light-bot_2-3.jpg/914px-Light-bot_2-3.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>将一个请求封装成一个对象，从而使您可以用不同的请求对客户进行参数化。</p>
</blockquote>
<p>命令模式有两个特征：</p>
<ul>
<li>命令逻辑对象化，这个命令对象可以从外界通过参数传入，也可内部实现。</li>
<li>支持undo，因为每个命令对象自己知道如何撤销（反命令），所以可以封装到命令对象内部。</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228cc35893ebcd?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">protocol Command &#123;</span><br><span class="line">    var operation: () -&gt; Void &#123; get &#125;</span><br><span class="line">    var backup: String &#123; get &#125;</span><br><span class="line">    func undo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct ConcreteCommand: Command &#123;</span><br><span class="line">    var backup: String</span><br><span class="line">    var operation: () -&gt; Void</span><br><span class="line">    func undo() &#123;</span><br><span class="line">        print(backup)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Invoker &#123;</span><br><span class="line">    var command: Command</span><br><span class="line">    func execute() &#123;</span><br><span class="line">        command.operation()</span><br><span class="line">    &#125;</span><br><span class="line">    func undo() &#123;</span><br><span class="line">        command.undo()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let printA = ConcreteCommand(backup: &quot;Default A&quot;) &#123;</span><br><span class="line">    print(&quot;A&quot;)</span><br><span class="line">&#125;</span><br><span class="line">let i1 = Invoker(command: printA)</span><br><span class="line">i1.execute() // OUTPUT: A</span><br><span class="line"></span><br><span class="line">let printB = ConcreteCommand(backup: &quot;Default B&quot;) &#123;</span><br><span class="line">    print(&quot;B&quot;)</span><br><span class="line">&#125;</span><br><span class="line">let i2 = Invoker(command: printB)</span><br><span class="line">i2.execute() // OUTPUT: B</span><br><span class="line">i2.undo() // OUTPUT: Default B</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Interpreter-解释器模式"><a href="#Interpreter-解释器模式" class="headerlink" title="Interpreter 解释器模式"></a>Interpreter 解释器模式</h2><blockquote>
<p>有了解释器，Skyrim的龙语也不在话下。</p>
</blockquote>
<p><img src="https://staticdelivery.nexusmods.com/mods/110/images/thumbnails/32821-3-1362476170.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="https://staticdelivery.nexusmods.com/mods/110/images/thumbnails/32821-3-1362476170.jpg" target="_blank" rel="noopener">https://staticdelivery.nexusmods.com/mods/110/images/thumbnails/32821-3-1362476170.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>给定一个语言，定义它的文法表示，并定义一个解释器，这个解释器使用该标识来解释语言中的句子。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228cf4dc93e284?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<p>我们可以实现一个能计算文本“1加1”的解释器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">protocol Expression &#123;</span><br><span class="line">    func evaluate(_ context: String) -&gt; Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MyAdditionExpression: Expression &#123;</span><br><span class="line">    func evaluate(_ context: String) -&gt; Int &#123;</span><br><span class="line">        return context.components(separatedBy: &quot;加&quot;)</span><br><span class="line">            .flatMap &#123; Int($0) &#125;</span><br><span class="line">            .reduce(0, +)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = MyAdditionExpression()</span><br><span class="line">c.evaluate(&quot;1加1&quot;) // OUTPUT: 2</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Iterator-迭代器模式"><a href="#Iterator-迭代器模式" class="headerlink" title="Iterator 迭代器模式"></a>Iterator 迭代器模式</h2><blockquote>
<p>迭代器就像回转寿司，保证每一道菜品都能得到展示。</p>
</blockquote>
<p><img src="http://www.sohu.com/a/207894434_99978064" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.sohu.com/a/207894434_99978064" target="_blank" rel="noopener">http://www.sohu.com/a/207894434_99978064</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>提供一种方法顺序访问一个聚合对象中各个元素, 而又无须暴露该对象的内部表示。</p>
</blockquote>
<p>迭代器就是能用hasNext和Next来遍历的一种集合元素。</p>
<p>他很像责任链，但是责任链是一个随时可断的链条（有可能在某一个节点不再把责任下放），他不强调一次完整的遍历。迭代器更像一次次的循环，每次循环都强调完整性，所以更适合集合的场景。</p>
<p>还有一个区别是迭代器是提供元素，而责任链在每一个经手人那做业务。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228d3d31b98ecd?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">protocol AbstractIterator &#123;</span><br><span class="line">    func hasNext() -&gt; Bool</span><br><span class="line">    func next() -&gt; Int?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteIterator: AbstractIterator &#123;</span><br><span class="line">    private var currentIndex = 0</span><br><span class="line">    var elements = [Int]()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    func next() -&gt; Int? &#123;</span><br><span class="line">        guard currentIndex &lt; elements.count else &#123; currentIndex = 0; return nil &#125;</span><br><span class="line">        defer &#123; currentIndex += 1 &#125;</span><br><span class="line">        return elements[currentIndex]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func hasNext() -&gt; Bool &#123;</span><br><span class="line">        guard currentIndex &lt; elements.count else &#123; currentIndex = 0; return false &#125;</span><br><span class="line">        return elements[currentIndex] != nil</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol AbstractCollection &#123;</span><br><span class="line">    func makeIterator() -&gt; AbstractIterator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteCollection: AbstractCollection &#123;</span><br><span class="line">    let iterator = ConcreteIterator()</span><br><span class="line">    func add(_ e: Int) &#123;</span><br><span class="line">        iterator.elements.append(e)</span><br><span class="line">    &#125;</span><br><span class="line">    func makeIterator() -&gt; AbstractIterator &#123;</span><br><span class="line">        return iterator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = ConcreteCollection()</span><br><span class="line">c.add(1)</span><br><span class="line">c.add(2)</span><br><span class="line">c.add(3)</span><br><span class="line"></span><br><span class="line">let iterator = c.makeIterator()</span><br><span class="line">while iterator.hasNext() &#123;</span><br><span class="line">    print(iterator.next() as Any)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Mediator-中介模式"><a href="#Mediator-中介模式" class="headerlink" title="Mediator 中介模式"></a>Mediator 中介模式</h2><blockquote>
<p>中介模式是对象间发消息的传话筒。</p>
</blockquote>
<p><img src="http://www.quanjing.com/imgbuy/top-959496.html" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.quanjing.com/imgbuy/top-959496.html" target="_blank" rel="noopener">http://www.quanjing.com/imgbuy/top-959496.html</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>用一个中介对象来封装一系列的对象交互，中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
</blockquote>
<p>中介模式对于通信关系复杂的系统有很好的解耦效果</p>
<p>它和观察者模式很像，区别在于观察者是不关心接受方的广播，中介者是介入两个（或多个）对象之间的定点消息传递。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228d53f4b53f69?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">protocol Receiver &#123;</span><br><span class="line">    func receive(message: String)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol Mediator: class &#123;</span><br><span class="line">    func notify(message: String)</span><br><span class="line">    func addReceiver(_ receiver: Receiver)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteMediator: Mediator &#123;</span><br><span class="line">    var recipients = [Receiver]()</span><br><span class="line">    func notify(message: String) &#123;</span><br><span class="line">        recipients.forEach &#123; $0.receive(message: message) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    func addReceiver(_ receiver: Receiver) &#123;</span><br><span class="line">        recipients.append(receiver)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol Component: Receiver &#123;</span><br><span class="line">    var mediator: Mediator? &#123; get &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct ConcreteComponent: Component &#123;</span><br><span class="line">    weak var mediator: Mediator?</span><br><span class="line">    var name: String</span><br><span class="line">    func receive(message: String) &#123;</span><br><span class="line">        print(name, &quot; receive: &quot;, message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var mediator = ConcreteMediator()</span><br><span class="line"></span><br><span class="line">let c1 = ConcreteComponent(mediator: mediator, name: &quot;c1&quot;)</span><br><span class="line">let c2 = ConcreteComponent(mediator: mediator, name: &quot;c2&quot;)</span><br><span class="line">let c3 = ConcreteComponent(mediator: mediator, name: &quot;c3&quot;)</span><br><span class="line"></span><br><span class="line">mediator.addReceiver(c1)</span><br><span class="line">mediator.addReceiver(c2)</span><br><span class="line">mediator.addReceiver(c3)</span><br><span class="line"></span><br><span class="line">//c1  receive:  hi</span><br><span class="line">//c2  receive:  hi</span><br><span class="line">//c3  receive:  hi</span><br><span class="line">c1.mediator?.notify(message: &quot;hi&quot;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Memento-备忘录模式"><a href="#Memento-备忘录模式" class="headerlink" title="Memento 备忘录模式"></a>Memento 备忘录模式</h2><blockquote>
<p>备忘录就是游戏存档。</p>
</blockquote>
<p><img src="http://gearnuke.com/wp-content/uploads/2015/05/witcher3-ps4-savedata-2.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://gearnuke.com/wp-content/uploads/2015/05/witcher3-ps4-savedata-2.jpg" target="_blank" rel="noopener">http://gearnuke.com/wp-content/uploads/2015/05/witcher3-ps4-savedata-2.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。</p>
</blockquote>
<p>这个模式有两个角色，一个是要存储的类型本身(Memento)和执行存储操作的保管人(Caretaker)。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228d64aa233b5b?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">typealias Memento = [String: String] // chatper: level</span><br><span class="line">protocol MementoConvertible &#123;</span><br><span class="line">    var memento: Memento &#123; get &#125;</span><br><span class="line">    init?(memento: Memento)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class GameState: MementoConvertible &#123;</span><br><span class="line">    var memento: Memento &#123;</span><br><span class="line">        return [chapter: level]</span><br><span class="line">    &#125;</span><br><span class="line">    var chapter: String</span><br><span class="line">    var level: String</span><br><span class="line">    </span><br><span class="line">    required init?(memento: Memento) &#123;</span><br><span class="line">        self.chapter = memento.keys.first ?? &quot;&quot;</span><br><span class="line">        self.level = memento.values.first ?? &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    init(chapter: String, level: String) &#123;</span><br><span class="line">        self.chapter = chapter</span><br><span class="line">        self.level = level</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol CaretakerConvertible &#123;</span><br><span class="line">    static func save(memonto: Memento, for key: String)</span><br><span class="line">    static func loadMemonto(for key: String) -&gt; Memento?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Caretaker: CaretakerConvertible &#123;</span><br><span class="line">    static func save(memonto: Memento, for key: String) &#123;</span><br><span class="line">        let defaults = UserDefaults.standard</span><br><span class="line">        defaults.set(memonto, forKey: key)</span><br><span class="line">        defaults.synchronize()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    static func loadMemonto(for key: String) -&gt; Memento? &#123;</span><br><span class="line">        let defaults = UserDefaults.standard</span><br><span class="line">        return defaults.object(forKey: key) as? Memento</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let g = GameState(chapter: &quot;Prologue&quot;, level: &quot;0&quot;)</span><br><span class="line">// after a while</span><br><span class="line">g.chapter = &quot;Second&quot;</span><br><span class="line">g.level = &quot;20&quot;</span><br><span class="line">// want a break</span><br><span class="line">Caretaker.save(memonto: g.memento, for: &quot;gamename&quot;)</span><br><span class="line">// load game</span><br><span class="line">let gameState = Caretaker.loadMemonto(for: &quot;gamename&quot;) // [&quot;Second&quot;: &quot;20&quot;]</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Observer-观察者模式"><a href="#Observer-观察者模式" class="headerlink" title="Observer 观察者模式"></a>Observer 观察者模式</h2><blockquote>
<p>观察者模式就像预购，支付了就坐等收货，省心省力。</p>
</blockquote>
<p>![](<a href="http://images.pushsquare.com/news/2015/01/what_the_hecks_going_on_with_playstation_store_pre-orders_in_europe/attachment/0/original.jpg" target="_blank" rel="noopener">http://images.pushsquare.com/news/2015/01/what_the_hecks_going_on_with_playstation_store_pre-orders_in_europe/attachment/0/original.jpg</a></p>
<blockquote>
<p>配图：<a href="http://images.pushsquare.com/news/2015/01/what_the_hecks_going_on_with_playstation_store_pre-orders_in_europe/attachment/0/original.jpg" target="_blank" rel="noopener">http://images.pushsquare.com/news/2015/01/what_the_hecks_going_on_with_playstation_store_pre-orders_in_europe/attachment/0/original.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
</blockquote>
<p><strong>观察者模式</strong>定义了对象之间的一对多依赖，这样一来，当一个对象改变状态时，它的所有依赖者都会收到通知并自动更新。</p>
<p>观察者模式适用在一个<strong>被观察者（数据源）要通知多个观察者</strong>的场景。</p>
<p>这个模式主要通过添加一层接口，来把观察者的具体类型擦除，从何实现松耦合。（针对接口编程，而非实现）</p>
<p>观察者模式一个最重要的特点就是它是一种推模型(PUSH)，在很多情况下比拉模型更高效和即时。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228da2e23244fc?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">protocol Observable &#123;</span><br><span class="line">    var observers: [Observer] &#123; get &#125;</span><br><span class="line">    func add(observer: Observer)</span><br><span class="line">    func remove(observer: Observer)</span><br><span class="line">    func notifyObservers()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteObservable: Observable &#123;</span><br><span class="line">    var observers = [Observer]()</span><br><span class="line">    func add(observer: Observer) &#123;</span><br><span class="line">        observers.append(observer)</span><br><span class="line">    &#125;</span><br><span class="line">    func remove(observer: Observer) &#123;</span><br><span class="line">        if let index = observers.index(where: &#123; $0 === observer &#125;) &#123;</span><br><span class="line">            observers.remove(at: index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    func notifyObservers() &#123;</span><br><span class="line">        observers.forEach &#123; $0.update() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol Observer: class &#123;</span><br><span class="line">    func update()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteObserverA: Observer &#123;</span><br><span class="line">    func update() &#123; print(&quot;A&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteObserverB: Observer &#123;</span><br><span class="line">    func update() &#123; print(&quot;B&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//////////////////////////////////</span><br><span class="line"></span><br><span class="line">let observable = ConcreteObservable()</span><br><span class="line">let a = ConcreteObserverA()</span><br><span class="line">let b = ConcreteObserverB()</span><br><span class="line">observable.add(observer: a)</span><br><span class="line">observable.add(observer: b)</span><br><span class="line">observable.notifyObservers() // output: A B</span><br><span class="line"></span><br><span class="line">observable.remove(observer: b)</span><br><span class="line">observable.notifyObservers() // output: A</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="State-状态模式"><a href="#State-状态模式" class="headerlink" title="State 状态模式"></a>State 状态模式</h2><blockquote>
<p>状态模式就像马里奥吃了各种蘑菇后的变身。</p>
</blockquote>
<p><img src="http://www.superluigibros.com/images/super_mario_bros_3_power_ups.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="http://www.superluigibros.com/images/super_mario_bros_3_power_ups.jpg" target="_blank" rel="noopener">http://www.superluigibros.com/images/super_mario_bros_3_power_ups.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>允许对象在内部状态发生改变时改变它的行为，对象看起来好像修改了它的类。</p>
</blockquote>
<p>状态模式很像策略模式，但是他封装的不是算法，而是一个一个本体下的不同状态。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228db1d5c7bca9?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">protocol State &#123;</span><br><span class="line">    func operation()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteStateA: State &#123;</span><br><span class="line">    func operation() &#123;</span><br><span class="line">        print(&quot;A&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteStateB: State &#123;</span><br><span class="line">    func operation() &#123;</span><br><span class="line">        print(&quot;B&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Context &#123;</span><br><span class="line">    var state: State = ConcreteStateA()</span><br><span class="line">    func someMethod() &#123;</span><br><span class="line">        state.operation()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let c = Context()</span><br><span class="line">c.someMethod() // OUTPUT: A</span><br><span class="line">c.state = ConcreteStateB() // switch state</span><br><span class="line">c.someMethod() // OUTPUT: B</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Strategy-策略模式"><a href="#Strategy-策略模式" class="headerlink" title="Strategy 策略模式"></a>Strategy 策略模式</h2><blockquote>
<p>策略模式就像不同的交通路线，可以相互替换，都能达到终点。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228dd0637fd07c?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<blockquote>
<p>配图：高德地图iOS</p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换。</p>
</blockquote>
<p>这个模式主要还是在解决一个<strong>稳定的继承树</strong>当遇到<strong>需求变化</strong>时的狼狈。他把变化的几种情况分门别类的封装好，然后把自己变化的部分隔离成一个接口实例(interface/protocol)，让子类继承后来做选择题。</p>
<p>一个需要转变的思维就是：建模一个类的时候不能只局限于物体（object），也可以是行为（behavior）的封装。</p>
<p>用继承来替换interface实现多态的behavior也是理论可行的。这个模式还有一个强大之处：他是动态的。就是至于子类选择了什么行为，不见得是写代码的时候写死的；也可以是类似用户点击一下切换了算法。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228dd3b95a8bda?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">protocol WeaponBehavior &#123;</span><br><span class="line">    func use()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SwordBehavior: WeaponBehavior &#123;</span><br><span class="line">    func use() &#123; print(&quot;sword&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class BowBehavior: WeaponBehavior &#123;</span><br><span class="line">    func use() &#123; print(&quot;bow&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Character &#123;</span><br><span class="line">    var weapon: WeaponBehavior?</span><br><span class="line">    func attack() &#123;  weapon?.use() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Knight: Character &#123;</span><br><span class="line">    override init() &#123;</span><br><span class="line">        super.init()</span><br><span class="line">        weapon = SwordBehavior()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Archer: Character &#123;</span><br><span class="line">    override init() &#123;</span><br><span class="line">        super.init()</span><br><span class="line">        weapon = BowBehavior()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">///////////////////////////////////</span><br><span class="line"></span><br><span class="line">Knight().attack() // output: sword</span><br><span class="line">Archer().attack() // output: bow</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Template-Method-模板方法模式"><a href="#Template-Method-模板方法模式" class="headerlink" title="Template Method 模板方法模式"></a>Template Method 模板方法模式</h2><blockquote>
<p>模板方法就是抽象类衍生出来的继承树。</p>
</blockquote>
<p><img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3167143621,3882552175&amp;fm=27&amp;gp=0.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3167143621,3882552175&amp;fm=27&amp;gp=0.jpg" target="_blank" rel="noopener">https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3167143621,3882552175&amp;fm=27&amp;gp=0.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
</blockquote>
<p>模板方法指的就是存在在抽象类中的方法声明，由子类具体实现。这样这套方法产生了<strong>一套模具不同产品</strong>的派生效果。</p>
<p>通过抽象类和子类实现多态。</p>
<p>很可惜Swift/Objective-C都没有抽象类, 所以用一般的class来实现</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228def70189866?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Soldier &#123;</span><br><span class="line">    func attack() &#123;&#125; // &lt;-- Template Method</span><br><span class="line">    private init() &#123;&#125; // &lt;-- avoid creation</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Paladin: Soldier &#123;</span><br><span class="line">    override func attack() &#123;</span><br><span class="line">        print(&quot;hammer&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Archer: Soldier &#123;</span><br><span class="line">    override func attack() &#123;</span><br><span class="line">        print(&quot;bow&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Visitor-访问者模式"><a href="#Visitor-访问者模式" class="headerlink" title="Visitor 访问者模式"></a>Visitor 访问者模式</h2><blockquote>
<p>访问者模式就像一个个酒店，他们都有接待你的接口，你入住后又会利用它的基础设施。</p>
</blockquote>
<p><img src="https://marketingland.com/wp-content/ml-loads/2014/08/hotel-bell-customer-service-ss-1920.jpg" alt=""></p>
<blockquote>
<p>配图：<a href="https://marketingland.com/wp-content/ml-loads/2014/08/hotel-bell-customer-service-ss-1920.jpg" target="_blank" rel="noopener">https://marketingland.com/wp-content/ml-loads/2014/08/hotel-bell-customer-service-ss-1920.jpg</a></p>
</blockquote>
<p><strong>官方定义</strong></p>
<blockquote>
<p>主要将数据结构与数据操作分离。</p>
</blockquote>
<p>号称最复杂的设计模式，先看一下实现代码。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/15/16228dfe6161d8d4?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">protocol Visitor &#123;</span><br><span class="line">    func visit(_ c: ComponentA)</span><br><span class="line">    func visit(_ c: ComponentB)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct ConcreteVisitor: Visitor &#123;</span><br><span class="line">    func visit(_ c: ComponentA) &#123;</span><br><span class="line">        c.featureA()</span><br><span class="line">    &#125;</span><br><span class="line">    func visit(_ c: ComponentB) &#123;</span><br><span class="line">        c.featureB()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protocol Component &#123;</span><br><span class="line">    func accept(_ v: Visitor)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct ComponentA: Component &#123;</span><br><span class="line">    func featureA() &#123;</span><br><span class="line">        print(&quot;Feature A&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    func accept(_ v: Visitor) &#123;</span><br><span class="line">        v.visit(self)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct ComponentB: Component &#123;</span><br><span class="line">    func featureB() &#123;</span><br><span class="line">        print(&quot;Feature B&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    func accept(_ v: Visitor) &#123;</span><br><span class="line">        v.visit(self)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let components: [Component] = [ComponentA(), ComponentB()]</span><br><span class="line">components.forEach &#123;</span><br><span class="line">    $0.accept(ConcreteVisitor())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要理解这个模式需要了解一些概念：</p>
<p>通过这篇文章可以了解到， 其实<a href="http://www.blogjava.net/chaocai/archive/2009/02/19/255640.html" target="_blank" rel="noopener">设计模式（GoF)中的Visitor模式就是Java解决Double Dispatch的一种应用。</a>，</p>
<p>我们用Swift实现一下文中双重派发问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">protocol Event &#123;&#125;</span><br><span class="line">class BlueEvent: Event &#123;&#125;</span><br><span class="line">class RedEvent: Event &#123;&#125;</span><br><span class="line"></span><br><span class="line">class Handler &#123;</span><br><span class="line">    func handle(_ e: Event) &#123;</span><br><span class="line">        print(&quot;Event&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    func handle(_ r: RedEvent) &#123;</span><br><span class="line">        print(&quot;RedEvent&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    func handle(_ b: BlueEvent) &#123;</span><br><span class="line">        print(&quot;BlueEvent&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let b = BlueEvent()</span><br><span class="line">let r = RedEvent()</span><br><span class="line">let c = Handler()</span><br><span class="line"></span><br><span class="line">c.handle(b) // OUTPUT: BlueEvent</span><br><span class="line">c.handle(r) // OUTPUT: RedEvent</span><br></pre></td></tr></table></figure>
<p>验证发现，Swift是支持双重派发的。</p>
<p>那什么是<strong>双重派发（Double Dispatch）</strong>？</p>
<p>要解释这个，要先搞清楚什么是派发<strong>（Dispatch）</strong>。</p>
<p>派发或者说Single Dispatch，Dynamic Dispatch，wiki是这样解释的：</p>
<blockquote>
<p>In most object-oriented systems, the concrete function that is called from a function call in the code depends on the dynamic type of a single object and therefore they are known as single dispatch calls, or simply virtual function calls.<br>抓要点说，就是多态的情况下，在运行时，虚方法是由哪个具体实现执行了，这样的绑定动作就是派发。</p>
</blockquote>
<p><strong>那什么虚方法？ 看一下wiki的解释：</strong></p>
<blockquote>
<p>In short, a virtual function defines a target function to be executed, but the target might not be known at compile time.<br>虚方法就是编译期还没确定实现的方法，我们可以理解成接口中声明的方法。</p>
</blockquote>
<p>好，我们现在知道了一次虚方法的绑定就是派发，双重派发就是两次绑定操作。</p>
<p>那双重派发的代码是如何触发派发的呢？</p>
<ul>
<li><strong>overload 重载</strong> 重载产生的多态引起一次派发</li>
<li><strong>override 重写</strong> 接口实现的多态引起第二次派发</li>
</ul>
<p>理解这些就知道这个模式在折腾什么了。</p>
<p>当然他也有另外的好处，就是可以让具体的业务类可以丢到集合里批量的执行accept visitor。</p>

      
    </div>
    
    
    

     

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="liuxc 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"><i class="fa fa-tag"></i> iOS</a>
          
            <a href="/tags/Swift/" rel="tag"><i class="fa fa-tag"></i> Swift</a>
          
            <a href="/tags/Design-Mode/" rel="tag"><i class="fa fa-tag"></i> Design Mode</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/10/iOS/源码分析/YTKNetwork源码解析/" rel="next" title="YTKNetwork源码解析">
                <i class="fa fa-chevron-left"></i> YTKNetwork源码解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/18/iOS/Swift访问控制/" rel="prev" title="Swift访问控制">
                Swift访问控制 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="liuxc" />
            
              <p class="site-author-name" itemprop="name">liuxc</p>
              <p class="site-description motion-element" itemprop="description">每天进步一点点</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/liuxc123" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="lxc_work@126.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/mirl-33/activities" target="_blank" title="知乎">
                    
                      <i class="fa fa-fw fa-globe"></i>知乎</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.jianshu.com/u/d96162b35a72" target="_blank" title="简书">
                    
                      <i class="fa fa-fw fa-globe"></i>简书</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本结构"><span class="nav-number">2.</span> <span class="nav-text">基本结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#目录"><span class="nav-number">3.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工厂模式"><span class="nav-number">4.</span> <span class="nav-text">工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无工厂-Non-Factory"><span class="nav-number">4.1.</span> <span class="nav-text">无工厂 Non-Factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单工厂-Simple-Factory"><span class="nav-number">4.2.</span> <span class="nav-text">简单工厂 Simple Factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工厂方法-Factory-Method"><span class="nav-number">4.3.</span> <span class="nav-text">工厂方法 Factory Method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽象工厂-Abstract-Factory"><span class="nav-number">4.4.</span> <span class="nav-text">抽象工厂 Abstract Factory</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">4.4.1.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Builder-建造者模式"><span class="nav-number">5.</span> <span class="nav-text">Builder 建造者模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prototype-原型模式"><span class="nav-number">6.</span> <span class="nav-text">Prototype 原型模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Singleton-单例模式"><span class="nav-number">7.</span> <span class="nav-text">Singleton 单例模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Adapter-适配器模式"><span class="nav-number">8.</span> <span class="nav-text">Adapter 适配器模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bridge-桥接模式"><span class="nav-number">9.</span> <span class="nav-text">Bridge 桥接模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Composite-组合模式"><span class="nav-number">10.</span> <span class="nav-text">Composite 组合模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Decorator-装饰者模式"><span class="nav-number">11.</span> <span class="nav-text">Decorator 装饰者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码"><span class="nav-number">11.1.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Facade-外观模式"><span class="nav-number">12.</span> <span class="nav-text">Facade 外观模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flyweight-享元模式"><span class="nav-number">13.</span> <span class="nav-text">Flyweight 享元模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxy-代理模式"><span class="nav-number">14.</span> <span class="nav-text">Proxy 代理模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chain-of-responsibility-责任链模式"><span class="nav-number">15.</span> <span class="nav-text">Chain of responsibility 责任链模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Command-命令模式"><span class="nav-number">16.</span> <span class="nav-text">Command 命令模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interpreter-解释器模式"><span class="nav-number">17.</span> <span class="nav-text">Interpreter 解释器模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Iterator-迭代器模式"><span class="nav-number">18.</span> <span class="nav-text">Iterator 迭代器模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mediator-中介模式"><span class="nav-number">19.</span> <span class="nav-text">Mediator 中介模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memento-备忘录模式"><span class="nav-number">20.</span> <span class="nav-text">Memento 备忘录模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Observer-观察者模式"><span class="nav-number">21.</span> <span class="nav-text">Observer 观察者模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#State-状态模式"><span class="nav-number">22.</span> <span class="nav-text">State 状态模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Strategy-策略模式"><span class="nav-number">23.</span> <span class="nav-text">Strategy 策略模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Template-Method-模板方法模式"><span class="nav-number">24.</span> <span class="nav-text">Template Method 模板方法模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Visitor-访问者模式"><span class="nav-number">25.</span> <span class="nav-text">Visitor 访问者模式</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liuxc</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">博客全站共&#58;</span>
    
    <span title="博客全站共">68.2k&nbsp字</span>
  
</div>


  <div class="powered-by">
    <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
      本站访客数:<span id="busuanzi_value_site_uv"></span></span>
  </div>





  
  <span class="post-meta-divider">|</span>
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2018/04/16/Design Mode/23个经典设计模式的Swift实现/';
          this.page.identifier = '2018/04/16/Design Mode/23个经典设计模式的Swift实现/';
          this.page.title = '23个经典设计模式的Swift实现';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.3"></script>


</body>
</html>
